{% extends "base.html" %}
{% from "icons.html" import icon %}
{% block title %}Nginx Logs - VPS Manager{% endblock %}
{% block page_title %}Nginx Logs{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">{{ icon('file-text') }} Nginx Error Log (last 20)</div>
    <div class="card-body" style="padding:0">
        {% if data.errors %}
            <div class="log-entries">
                {% for entry in data.errors %}
                <div class="log-entry" onclick="this.classList.toggle('expanded')">
                    <div class="log-entry-summary">
                        <span class="log-timestamp">{{ entry.timestamp }}</span>
                        <span class="log-level log-level-{{ entry.level }}">{{ entry.level }}</span>
                        <span class="log-message">{{ entry.message }}</span>
                    </div>
                    <div class="log-detail">
                        <pre style="margin:0;border:none;background:transparent;padding:8px 0;font-size:12px">{{ entry.raw }}</pre>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="padding:16px">
                <span class="badge badge-green">No errors in nginx error.log</span>
            </div>
        {% endif %}
    </div>
</div>

{% if data.php_errors %}
<div class="card">
    <div class="card-header">{{ icon('file-text') }} PHP-FPM Error Log</div>
    <div class="card-body" style="padding:0">
        <div class="log-entries">
            {% for entry in data.php_errors %}
            <div class="log-entry" onclick="this.classList.toggle('expanded')">
                <div class="log-entry-summary">
                    <span class="log-level log-level-error">php</span>
                    <span class="log-message">{{ entry.message }}</span>
                </div>
                <div class="log-detail">
                    <pre style="margin:0;border:none;background:transparent;padding:8px 0;font-size:12px">{{ entry.raw }}</pre>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

{% if data.per_site %}
<div class="card">
    <div class="card-header">{{ icon('folder') }} Error logs per site</div>
    <div class="card-body">
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>Log file</th>
                        <th>Lines</th>
                        <th>Last line</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in data.per_site %}
                    <tr>
                        <td><code>{{ log.name }}</code></td>
                        <td>
                            {% if log.lines == '0' %}
                                <span class="badge badge-green">0</span>
                            {% else %}
                                <span class="badge badge-yellow">{{ log.lines }}</span>
                            {% endif %}
                        </td>
                        <td><span style="color:var(--text-muted);font-size:12px">{{ log.last }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

{% if data.access_summary %}
<div class="card">
    <div class="card-header">{{ icon('bar-chart') }} Access log summary</div>
    <div class="card-body">
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>HTTP Status</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in data.access_summary %}
                    <tr>
                        <td>
                            {% if item.code.startswith('2') %}
                                <span class="badge badge-green">{{ item.code }}</span>
                            {% elif item.code.startswith('3') %}
                                <span class="badge" style="background:rgba(57,210,192,0.15);color:var(--cyan)">{{ item.code }}</span>
                            {% elif item.code.startswith('4') %}
                                <span class="badge badge-yellow">{{ item.code }}</span>
                            {% elif item.code.startswith('5') %}
                                <span class="badge badge-red">{{ item.code }}</span>
                            {% else %}
                                <span class="badge">{{ item.code }}</span>
                            {% endif %}
                        </td>
                        <td>{{ item.count }}x</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
